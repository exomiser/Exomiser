package org.monarchinitiative.exomiser.data.genome.model.parsers;

import org.junit.jupiter.api.Test;
import org.monarchinitiative.exomiser.core.proto.AlleleData;
import org.monarchinitiative.exomiser.core.proto.AlleleProto;
import org.monarchinitiative.exomiser.data.genome.model.Allele;

import java.util.List;
import java.util.Map;
import java.util.Set;

import static org.hamcrest.MatcherAssert.assertThat;
import static org.hamcrest.Matchers.equalTo;

class Gnomad3MitoAlleleParserTest {

    private final Gnomad3MitoAlleleParser instance = new Gnomad3MitoAlleleParser();

    @Test
    void name() {
        var result = instance.parseLine("chrM\t3\t.\tT\tC\t.\tPASS\tvariant_collapsed=T3C;vep=C|intergenic_variant|MODIFIER|||Intergenic||||||||||||1|||SNV||||||||||||||||||||||||;base_qual_hist=0|0|0|0|0|0|0|0|0|0;position_hist=0|0|0|0|0|0|0|0|0|0;strand_bias_hist=0|0|0|0|0|0|0|0|0|0;weak_evidence_hist=0|0|0|0|0|0|0|0|0|0;contamination_hist=0|0|0|0|0|0|0|0|0|0;heteroplasmy_below_min_het_threshold_hist=0|0|0|0|0|0|0|0|0|0;excluded_AC=0;AN=56434;AC_hom=19;AC_het=1;hl_hist=0|0|0|0|0|0|0|0|1|19;dp_mean=2522.87;mq_mean=60.0000;tlod_mean=6805.54;AF_hom=0.000336676;AF_het=1.77198e-05;max_hl=0.997000;hap_AN=2680|1537|868|603|34|282|91|14784|701|934|3144|2732|663|2977|4724|5672|126|1|1298|366|7|393|3080|6037|1234|819|546|12|89;hap_AC_het=0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|1|0|0|0|0|0|0;hap_AC_hom=0|0|0|0|0|0|0|1|0|0|0|0|0|0|0|0|0|0|0|0|0|0|17|1|0|0|0|0|0;hap_AF_hom=0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|6.76407e-05|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|5.51948e-03|1.65645e-04|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00;hap_AF_het=0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|3.24675e-04|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00;hap_hl_hist=0|0|0|0|0|0|0|0|0|0,0|0|0|0|0|0|0|0|0|0,0|0|0|0|0|0|0|0|0|0,0|0|0|0|0|0|0|0|0|0,0|0|0|0|0|0|0|0|0|0,0|0|0|0|0|0|0|0|0|0,0|0|0|0|0|0|0|0|0|0,0|0|0|0|0|0|0|0|0|1,0|0|0|0|0|0|0|0|0|0,0|0|0|0|0|0|0|0|0|0,0|0|0|0|0|0|0|0|0|0,0|0|0|0|0|0|0|0|0|0,0|0|0|0|0|0|0|0|0|0,0|0|0|0|0|0|0|0|0|0,0|0|0|0|0|0|0|0|0|0,0|0|0|0|0|0|0|0|0|0,0|0|0|0|0|0|0|0|0|0,0|0|0|0|0|0|0|0|0|0,0|0|0|0|0|0|0|0|0|0,0|0|0|0|0|0|0|0|0|0,0|0|0|0|0|0|0|0|0|0,0|0|0|0|0|0|0|0|0|0,0|0|0|0|0|0|0|0|1|17,0|0|0|0|0|0|0|0|0|1,0|0|0|0|0|0|0|0|0|0,0|0|0|0|0|0|0|0|0|0,0|0|0|0|0|0|0|0|0|0,0|0|0|0|0|0|0|0|0|0,0|0|0|0|0|0|0|0|0|0;hap_faf_hom=0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|3.51633e-03|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00;hapmax_AF_hom=T;hapmax_AF_het=T;faf_hapmax_hom=0.00351633;pop_AN=14347|392|5718|1415|1482|4892|25849|826|1493|20;pop_AC_het=0|0|0|0|0|0|1|0|0|0;pop_AC_hom=0|0|0|0|0|0|19|0|0|0;pop_AF_hom=0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|7.35038e-04|0.00000e+00|0.00000e+00|0.00000e+00;pop_AF_het=0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|3.86862e-05|0.00000e+00|0.00000e+00|0.00000e+00;pop_hl_hist=0|0|0|0|0|0|0|0|0|0,0|0|0|0|0|0|0|0|0|0,0|0|0|0|0|0|0|0|0|0,0|0|0|0|0|0|0|0|0|0,0|0|0|0|0|0|0|0|0|0,0|0|0|0|0|0|0|0|0|0,0|0|0|0|0|0|0|0|1|19,0|0|0|0|0|0|0|0|0|0,0|0|0|0|0|0|0|0|0|0,0|0|0|0|0|0|0|0|0|0;age_hist_hom_bin_freq=0|1|0|2|1|0|0|2|0|0;age_hist_hom_n_smaller=3;age_hist_hom_n_larger=0;age_hist_het_bin_freq=0|0|0|0|0|0|0|0|0|0;age_hist_het_n_smaller=0;age_hist_het_n_larger=0;dp_hist_all_n_larger=35782;dp_hist_alt_n_larger=11;dp_hist_all_bin_freq=0|1|217|1234|2334|2600|2967|3324|3791|4184;dp_hist_alt_bin_freq=0|0|0|0|2|0|1|4|2|0");
        Allele allele = new Allele(25, 3, "T", "C");
        allele.addFrequency(AlleleData.frequencyOf(AlleleProto.FrequencySource.GNOMAD_G_NFE, 19, 25849));
        assertThat(result, equalTo(List.of(allele)));
    }

    @Test
    void testFindInfoKey() {
        var value = instance.findInfoFieldValue("pop_AC_het", "chrM\t3\t.\tT\tC\t.\tPASS\tvariant_collapsed=T3C;vep=C|intergenic_variant|MODIFIER|||Intergenic||||||||||||1|||SNV||||||||||||||||||||||||;base_qual_hist=0|0|0|0|0|0|0|0|0|0;position_hist=0|0|0|0|0|0|0|0|0|0;strand_bias_hist=0|0|0|0|0|0|0|0|0|0;weak_evidence_hist=0|0|0|0|0|0|0|0|0|0;contamination_hist=0|0|0|0|0|0|0|0|0|0;heteroplasmy_below_min_het_threshold_hist=0|0|0|0|0|0|0|0|0|0;excluded_AC=0;AN=56434;AC_hom=19;AC_het=1;hl_hist=0|0|0|0|0|0|0|0|1|19;dp_mean=2522.87;mq_mean=60.0000;tlod_mean=6805.54;AF_hom=0.000336676;AF_het=1.77198e-05;max_hl=0.997000;hap_AN=2680|1537|868|603|34|282|91|14784|701|934|3144|2732|663|2977|4724|5672|126|1|1298|366|7|393|3080|6037|1234|819|546|12|89;hap_AC_het=0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|1|0|0|0|0|0|0;hap_AC_hom=0|0|0|0|0|0|0|1|0|0|0|0|0|0|0|0|0|0|0|0|0|0|17|1|0|0|0|0|0;hap_AF_hom=0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|6.76407e-05|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|5.51948e-03|1.65645e-04|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00;hap_AF_het=0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|3.24675e-04|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00;hap_hl_hist=0|0|0|0|0|0|0|0|0|0,0|0|0|0|0|0|0|0|0|0,0|0|0|0|0|0|0|0|0|0,0|0|0|0|0|0|0|0|0|0,0|0|0|0|0|0|0|0|0|0,0|0|0|0|0|0|0|0|0|0,0|0|0|0|0|0|0|0|0|0,0|0|0|0|0|0|0|0|0|1,0|0|0|0|0|0|0|0|0|0,0|0|0|0|0|0|0|0|0|0,0|0|0|0|0|0|0|0|0|0,0|0|0|0|0|0|0|0|0|0,0|0|0|0|0|0|0|0|0|0,0|0|0|0|0|0|0|0|0|0,0|0|0|0|0|0|0|0|0|0,0|0|0|0|0|0|0|0|0|0,0|0|0|0|0|0|0|0|0|0,0|0|0|0|0|0|0|0|0|0,0|0|0|0|0|0|0|0|0|0,0|0|0|0|0|0|0|0|0|0,0|0|0|0|0|0|0|0|0|0,0|0|0|0|0|0|0|0|0|0,0|0|0|0|0|0|0|0|1|17,0|0|0|0|0|0|0|0|0|1,0|0|0|0|0|0|0|0|0|0,0|0|0|0|0|0|0|0|0|0,0|0|0|0|0|0|0|0|0|0,0|0|0|0|0|0|0|0|0|0,0|0|0|0|0|0|0|0|0|0;hap_faf_hom=0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|3.51633e-03|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00;hapmax_AF_hom=T;hapmax_AF_het=T;faf_hapmax_hom=0.00351633;pop_AN=14347|392|5718|1415|1482|4892|25849|826|1493|20;pop_AC_het=0|0|0|0|0|0|1|0|0|0;pop_AC_hom=0|0|0|0|0|0|19|0|0|0;pop_AF_hom=0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|7.35038e-04|0.00000e+00|0.00000e+00|0.00000e+00;pop_AF_het=0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|3.86862e-05|0.00000e+00|0.00000e+00|0.00000e+00;pop_hl_hist=0|0|0|0|0|0|0|0|0|0,0|0|0|0|0|0|0|0|0|0,0|0|0|0|0|0|0|0|0|0,0|0|0|0|0|0|0|0|0|0,0|0|0|0|0|0|0|0|0|0,0|0|0|0|0|0|0|0|0|0,0|0|0|0|0|0|0|0|1|19,0|0|0|0|0|0|0|0|0|0,0|0|0|0|0|0|0|0|0|0,0|0|0|0|0|0|0|0|0|0;age_hist_hom_bin_freq=0|1|0|2|1|0|0|2|0|0;age_hist_hom_n_smaller=3;age_hist_hom_n_larger=0;age_hist_het_bin_freq=0|0|0|0|0|0|0|0|0|0;age_hist_het_n_smaller=0;age_hist_het_n_larger=0;dp_hist_all_n_larger=35782;dp_hist_alt_n_larger=11;dp_hist_all_bin_freq=0|1|217|1234|2334|2600|2967|3324|3791|4184;dp_hist_alt_bin_freq=0|0|0|0|2|0|1|4|2|0");
        assertThat(value, equalTo("0|0|0|0|0|0|1|0|0|0"));
    }

    @Test
    void testFindInfoFields() {
        var value = instance.mapInfoFields(Set.of("pop_AC_het", "pop_AN"), "variant_collapsed=T3C;vep=C|intergenic_variant|MODIFIER|||Intergenic||||||||||||1|||SNV||||||||||||||||||||||||;base_qual_hist=0|0|0|0|0|0|0|0|0|0;position_hist=0|0|0|0|0|0|0|0|0|0;strand_bias_hist=0|0|0|0|0|0|0|0|0|0;weak_evidence_hist=0|0|0|0|0|0|0|0|0|0;contamination_hist=0|0|0|0|0|0|0|0|0|0;heteroplasmy_below_min_het_threshold_hist=0|0|0|0|0|0|0|0|0|0;excluded_AC=0;AN=56434;AC_hom=19;AC_het=1;hl_hist=0|0|0|0|0|0|0|0|1|19;dp_mean=2522.87;mq_mean=60.0000;tlod_mean=6805.54;AF_hom=0.000336676;AF_het=1.77198e-05;max_hl=0.997000;hap_AN=2680|1537|868|603|34|282|91|14784|701|934|3144|2732|663|2977|4724|5672|126|1|1298|366|7|393|3080|6037|1234|819|546|12|89;hap_AC_het=0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|1|0|0|0|0|0|0;hap_AC_hom=0|0|0|0|0|0|0|1|0|0|0|0|0|0|0|0|0|0|0|0|0|0|17|1|0|0|0|0|0;hap_AF_hom=0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|6.76407e-05|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|5.51948e-03|1.65645e-04|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00;hap_AF_het=0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|3.24675e-04|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00;hap_hl_hist=0|0|0|0|0|0|0|0|0|0,0|0|0|0|0|0|0|0|0|0,0|0|0|0|0|0|0|0|0|0,0|0|0|0|0|0|0|0|0|0,0|0|0|0|0|0|0|0|0|0,0|0|0|0|0|0|0|0|0|0,0|0|0|0|0|0|0|0|0|0,0|0|0|0|0|0|0|0|0|1,0|0|0|0|0|0|0|0|0|0,0|0|0|0|0|0|0|0|0|0,0|0|0|0|0|0|0|0|0|0,0|0|0|0|0|0|0|0|0|0,0|0|0|0|0|0|0|0|0|0,0|0|0|0|0|0|0|0|0|0,0|0|0|0|0|0|0|0|0|0,0|0|0|0|0|0|0|0|0|0,0|0|0|0|0|0|0|0|0|0,0|0|0|0|0|0|0|0|0|0,0|0|0|0|0|0|0|0|0|0,0|0|0|0|0|0|0|0|0|0,0|0|0|0|0|0|0|0|0|0,0|0|0|0|0|0|0|0|0|0,0|0|0|0|0|0|0|0|1|17,0|0|0|0|0|0|0|0|0|1,0|0|0|0|0|0|0|0|0|0,0|0|0|0|0|0|0|0|0|0,0|0|0|0|0|0|0|0|0|0,0|0|0|0|0|0|0|0|0|0,0|0|0|0|0|0|0|0|0|0;hap_faf_hom=0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|3.51633e-03|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00;hapmax_AF_hom=T;hapmax_AF_het=T;faf_hapmax_hom=0.00351633;pop_AN=14347|392|5718|1415|1482|4892|25849|826|1493|20;pop_AC_het=0|0|0|0|0|0|1|0|0|0;pop_AC_hom=0|0|0|0|0|0|19|0|0|0;pop_AF_hom=0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|7.35038e-04|0.00000e+00|0.00000e+00|0.00000e+00;pop_AF_het=0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|0.00000e+00|3.86862e-05|0.00000e+00|0.00000e+00|0.00000e+00;pop_hl_hist=0|0|0|0|0|0|0|0|0|0,0|0|0|0|0|0|0|0|0|0,0|0|0|0|0|0|0|0|0|0,0|0|0|0|0|0|0|0|0|0,0|0|0|0|0|0|0|0|0|0,0|0|0|0|0|0|0|0|0|0,0|0|0|0|0|0|0|0|1|19,0|0|0|0|0|0|0|0|0|0,0|0|0|0|0|0|0|0|0|0,0|0|0|0|0|0|0|0|0|0;age_hist_hom_bin_freq=0|1|0|2|1|0|0|2|0|0;age_hist_hom_n_smaller=3;age_hist_hom_n_larger=0;age_hist_het_bin_freq=0|0|0|0|0|0|0|0|0|0;age_hist_het_n_smaller=0;age_hist_het_n_larger=0;dp_hist_all_n_larger=35782;dp_hist_alt_n_larger=11;dp_hist_all_bin_freq=0|1|217|1234|2334|2600|2967|3324|3791|4184;dp_hist_alt_bin_freq=0|0|0|0|2|0|1|4|2|0");
        assertThat(value, equalTo(Map.of("pop_AC_het", "0|0|0|0|0|0|1|0|0|0",
                "pop_AN", "14347|392|5718|1415|1482|4892|25849|826|1493|20"))
        );
    }
}